# Spring Cloud Feign

## 목차
1. Feign Client 정의
2. Feign Client 예제
3. Feign Client 추가 설정
___

## __개요__
대부분 서비스들이 API 호출을 RestTemplate 이용해 호출을 하고 있었다.  
나는 오히려 RestTemplate 사용하지 않고 Feign Client를 이용해 API 호출을 하는데 더 익숙했다.
새로운 서비스 개발을 하는데 Feign Client를 이용해 호출을 하려고 하기 때문에 Feign Client에 대해서 다시 공부해보려고 한다.

___

## __상세__


### 1. Feign Client 정의
Feign은 넷플릭스에서 개발한 웹 서비스 Client Binder 도구.  
어노테이션을 붙이고, interface를 선언하여 쉽고 편하게 사용할 수 있다.

### 2. Feign Client 예제

1. spring-cloud-starter-openfeign maven 추가
``` xml
    <properties>
        <java.version>1.8</java.version>
            <spring-cloud.version>Finchley.RELEASE</spring-cloud.version>
    </properties>
...
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-openfeign</artifactId>
        </dependency>
...
    </dependencies>
    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-dependencies</artifactId>
                <version>${spring-cloud.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>
```

2. @EnableFeignClients 추가 : @FeignClient를 찾아 구현체를 생성하는 역할
``` java
@SpringBootApplication
@EnableFeignClients
public class ParsingApplication {

    public static void main(String[] args) {
        SpringApplication.run(ParsingApplication.class, args);
    }

}
```

3. @FeignClient 인터페이스 생성
``` java
@FeignClient(value = "open-api", url = "http://openapitraffic.daejeon.go.kr/api/rest/busRouteInfo/")
public interface OpenAPIClient {

    @GetMapping("/getRouteInfoAll")
    public String getRouteInfoAll(@RequestParam String serviceKey, @RequestParam String reqPage);

}
```

`Error Message`
```
Caused by: java.lang.ClassNotFoundException: org.springframework.boot.context.properties.ConfigurationBeanFactoryMetadata
	at java.net.URLClassLoader.findClass(URLClassLoader.java:382) ~[na:1.8.0_281]
	at java.lang.ClassLoader.loadClass(ClassLoader.java:418) ~[na:1.8.0_281]
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:355) ~[na:1.8.0_281]
	at java.lang.ClassLoader.loadClass(ClassLoader.java:351) ~[na:1.8.0_281]
	... 114 common frames omitted
```

에러 발생 뭔가 못찾는거 같다.  
구글링 해보니 spring cloud reference에 Spring boot와 Spring cloud version을 맞춰줘야 한다고 한다.  

`spring boot vs spring cloud version`
<img src = "https://github.com/people92/people92.github.io/blob/master/img/springcloudversion.png?raw=true">


``` xml
 <spring-cloud.version>2020.0.0</spring-cloud.version>
```

spring cloud version을 바꿔주니 정상 작동한다.

`Test 코드`
``` java
@SpringBootTest
public class FeignClientTest {

    @Autowired
    OpenAPIClient openAPIClient;

    @Test
    void getMethodFeignClientTest() {
        String serviceKey = "ERvgM5YJuigXEYahj%2FZwKcD13pTrKUYUZOwWRuamCJfozqcMh4xyI9iMPTApsOQTzGcTeRJH7KIHmywWmYxe1g%3D%3D";

        String reqPage = "1";

        String response = openAPIClient.getRouteInfoAll(serviceKey, reqPage);

        Assertions.assertNotNull(response);
    }
}
```

### 3. Feign Client 추가 설정


___


## __참고__
https://woowabros.github.io/experience/2019/05/29/feign.html  
https://woowabros.github.io/experience/2019/12/20/feign2.html  
